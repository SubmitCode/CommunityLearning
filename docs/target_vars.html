---

title: Feature Engineering und Target Variablen

keywords: fastai
sidebar: home_sidebar

summary: "In diesem Modul werden zusätzliche Features berechnet und die Zielvariablen modeliert."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 03_target_vars.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    {% raw %}
        
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autotime
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>time: 138 ms
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>time: 1.03 ms
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_data" class="doc_header"><code>load_data</code><a href="https://github.com/WFR/community_learning/tree/master/community_learning/features.py#L12" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_data</code>(<strong><code>path</code></strong>=<em><code>'data/interim/02_train.csv'</code></em>)</p>
</blockquote>
<p>load data</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">()</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>time: 19.1 s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>ind_empleado</th>
      <th>pais_residencia</th>
      <th>sexo</th>
      <th>age</th>
      <th>ind_nuevo</th>
      <th>antiguedad</th>
      <th>indrel</th>
      <th>indrel_1mes</th>
      <th>tiprel_1mes</th>
      <th>...</th>
      <th>month_int</th>
      <th>fecha_alta_month</th>
      <th>fecha_alta_year</th>
      <th>fecha_alta_day</th>
      <th>fecha_alta_month_int</th>
      <th>fecha_alta_day_int</th>
      <th>ult_fec_cli_1t_month</th>
      <th>ult_fec_cli_1t_year</th>
      <th>ult_fec_cli_1t_day</th>
      <th>ult_fec_cli_1t_month_int</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>740987</th>
      <td>224166</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>49</td>
      <td>0</td>
      <td>173</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>2</td>
      <td>2</td>
      <td>6</td>
      <td>21</td>
      <td>74</td>
      <td>2271</td>
      <td>1</td>
      <td>5</td>
      <td>1</td>
      <td>61</td>
    </tr>
    <tr>
      <th>742202</th>
      <td>351179</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>50</td>
      <td>0</td>
      <td>159</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>2</td>
      <td>4</td>
      <td>7</td>
      <td>16</td>
      <td>88</td>
      <td>2691</td>
      <td>1</td>
      <td>5</td>
      <td>1</td>
      <td>61</td>
    </tr>
    <tr>
      <th>7158784</th>
      <td>1434285</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20</td>
      <td>1</td>
      <td>4</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>12</td>
      <td>8</td>
      <td>20</td>
      <td>11</td>
      <td>248</td>
      <td>7551</td>
      <td>1</td>
      <td>5</td>
      <td>1</td>
      <td>61</td>
    </tr>
    <tr>
      <th>6710345</th>
      <td>1295159</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>22</td>
      <td>0</td>
      <td>16</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>12</td>
      <td>8</td>
      <td>19</td>
      <td>7</td>
      <td>236</td>
      <td>7182</td>
      <td>1</td>
      <td>5</td>
      <td>1</td>
      <td>61</td>
    </tr>
    <tr>
      <th>4158374</th>
      <td>299372</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>56</td>
      <td>0</td>
      <td>88</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>8</td>
      <td>4</td>
      <td>13</td>
      <td>25</td>
      <td>160</td>
      <td>4890</td>
      <td>1</td>
      <td>5</td>
      <td>1</td>
      <td>61</td>
    </tr>
    <tr>
      <th>5332744</th>
      <td>1207608</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>24</td>
      <td>0</td>
      <td>24</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>10</td>
      <td>10</td>
      <td>18</td>
      <td>24</td>
      <td>226</td>
      <td>6894</td>
      <td>1</td>
      <td>5</td>
      <td>1</td>
      <td>61</td>
    </tr>
    <tr>
      <th>5739010</th>
      <td>316607</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>43</td>
      <td>0</td>
      <td>165</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>10</td>
      <td>1</td>
      <td>7</td>
      <td>16</td>
      <td>85</td>
      <td>2601</td>
      <td>1</td>
      <td>5</td>
      <td>1</td>
      <td>61</td>
    </tr>
    <tr>
      <th>10251485</th>
      <td>429249</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>73</td>
      <td>0</td>
      <td>154</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>17</td>
      <td>7</td>
      <td>8</td>
      <td>28</td>
      <td>103</td>
      <td>3158</td>
      <td>1</td>
      <td>5</td>
      <td>1</td>
      <td>61</td>
    </tr>
    <tr>
      <th>9873191</th>
      <td>1147941</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>27</td>
      <td>0</td>
      <td>33</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>16</td>
      <td>7</td>
      <td>18</td>
      <td>25</td>
      <td>223</td>
      <td>6805</td>
      <td>1</td>
      <td>5</td>
      <td>1</td>
      <td>61</td>
    </tr>
    <tr>
      <th>10574999</th>
      <td>1315531</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>22</td>
      <td>0</td>
      <td>20</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>17</td>
      <td>9</td>
      <td>19</td>
      <td>24</td>
      <td>237</td>
      <td>7229</td>
      <td>1</td>
      <td>5</td>
      <td>1</td>
      <td>61</td>
    </tr>
  </tbody>
</table>
<p>10 rows × 56 columns</p>
</div>
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>time: 9.37 ms
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>time: 482 µs
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>time: 1.29 ms
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="calculate_targets" class="doc_header"><code>calculate_targets</code><a href="https://github.com/WFR/community_learning/tree/master/community_learning/features.py#L27" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>calculate_targets</code>(<strong><code>df</code></strong>:<code>DataFrame</code>, <strong><code>target_products</code></strong>:<code>list</code>=<em><code>['ind_ahor_fin_ult1', 'ind_aval_fin_ult1', 'ind_cco_fin_ult1', 'ind_cder_fin_ult1', 'ind_cno_fin_ult1', 'ind_ctju_fin_ult1', 'ind_ctma_fin_ult1', 'ind_ctop_fin_ult1', 'ind_ctpp_fin_ult1', 'ind_deco_fin_ult1', 'ind_deme_fin_ult1', 'ind_dela_fin_ult1', 'ind_ecue_fin_ult1', 'ind_fond_fin_ult1', 'ind_hip_fin_ult1', 'ind_plan_fin_ult1', 'ind_pres_fin_ult1', 'ind_reca_fin_ult1', 'ind_tjcr_fin_ult1', 'ind_valo_fin_ult1', 'ind_viv_fin_ult1', 'ind_nomina_ult1', 'ind_nom_pens_ult1', 'ind_recibo_ult1']</code></em>)</p>
</blockquote>
<p>add the shifted product values and calculate target variables</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df1</span> <span class="o">=</span> <span class="n">calculate_targets</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">target_cols</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">df1</span><span class="p">[</span><span class="s1">&#39;id_shift_1&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>time: 242 ms
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@call_parse</span>
<span class="k">def</span> <span class="nf">calculate_main</span><span class="p">(</span><span class="n">source</span><span class="p">:</span><span class="n">Param</span><span class="p">(</span><span class="s2">&quot;source csv file&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span><span class="o">=</span><span class="s1">&#39;data/interim/02_train.csv&#39;</span><span class="p">,</span>
                   <span class="n">dest</span><span class="p">:</span><span class="n">Param</span><span class="p">(</span><span class="s2">&quot;destination csv file&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span><span class="o">=</span><span class="s1">&#39;data/interim/03_train.csv&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;calculate target variables and delayed product features&quot;&quot;&quot;</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">calculate_targets</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
    
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>time: 2.46 ms
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">calculate_main</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>ind_empleado</th>
      <th>pais_residencia</th>
      <th>sexo</th>
      <th>age</th>
      <th>ind_nuevo</th>
      <th>antiguedad</th>
      <th>indrel</th>
      <th>indrel_1mes</th>
      <th>tiprel_1mes</th>
      <th>...</th>
      <th>ind_hip_fin_ult1_s_1</th>
      <th>ind_plan_fin_ult1_s_1</th>
      <th>ind_pres_fin_ult1_s_1</th>
      <th>ind_reca_fin_ult1_s_1</th>
      <th>ind_tjcr_fin_ult1_s_1</th>
      <th>ind_valo_fin_ult1_s_1</th>
      <th>ind_viv_fin_ult1_s_1</th>
      <th>ind_nomina_ult1_s_1</th>
      <th>ind_nom_pens_ult1_s_1</th>
      <th>ind_recibo_ult1_s_1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>796881</th>
      <td>15889</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>56</td>
      <td>0</td>
      <td>245</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1202651</th>
      <td>15889</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>56</td>
      <td>0</td>
      <td>245</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1643630</th>
      <td>15889</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>56</td>
      <td>0</td>
      <td>245</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2514542</th>
      <td>15889</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>56</td>
      <td>0</td>
      <td>245</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2705368</th>
      <td>15889</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>56</td>
      <td>0</td>
      <td>245</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7652737</th>
      <td>1454620</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20</td>
      <td>1</td>
      <td>4</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8230649</th>
      <td>1454620</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20</td>
      <td>1</td>
      <td>5</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9036293</th>
      <td>1454620</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20</td>
      <td>0</td>
      <td>6</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9798618</th>
      <td>1454620</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20</td>
      <td>0</td>
      <td>7</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>10460198</th>
      <td>1454620</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20</td>
      <td>0</td>
      <td>8</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>10143523 rows × 81 columns</p>
</div>
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>time: 2min 16s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.export</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">notebook2script</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Converted 00_data_prep.ipynb.
Converted 00_data_preparation.ipynb.
Converted 00_data_preparation_CCA.ipynb.
Converted 01_data_preprocess.ipynb.
Converted 02_data_Cleaning.ipynb.
Converted 03_target_vars.ipynb.
Converted 04_base_model.ipynb.
Converted index.ipynb.
time: 96.7 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}
</div>
 

